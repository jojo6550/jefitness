document.addEventListener("DOMContentLoaded",()=>{var e=document.getElementById("userProfileForm");let a=document.getElementById("formMessage"),c=["localhost","127.0.0.1"].includes(window.location.hostname)?"http://localhost:10000":"https://jefitness.onrender.com";function g(e,t="success"){a.textContent=e,a.className="alert alert-"+t,a.classList.remove("d-none"),setTimeout(()=>{a.classList.add("d-none")},5e3)}e.addEventListener("submit",async e=>{e.preventDefault();var[e,...t]=document.getElementById("fullName").value.trim().split(" "),t=t.join(" "),a=document.getElementById("dob").value||null,n=document.getElementById("gender").value||null,l=document.getElementById("phone").value.trim()||null,o=document.getElementById("activityStatus").value||null,d=parseFloat(document.getElementById("startWeight").value)||null,r=parseFloat(document.getElementById("currentWeight").value)||null,u=document.getElementById("goals").value.trim()||null,s=document.getElementById("reason").value.trim()||null;if(e&&t){e={firstName:e,lastName:t,dob:a,gender:n,phone:l,activityStatus:o,startWeight:d,currentWeight:r,goals:u,reason:s};try{var m,i=await fetch(c+"/api/auth/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(e)});if(!i.ok)throw m=await i.json(),new Error(m.msg||"Failed to update profile");await i.json();g("Profile updated successfully.")}catch(e){g(e.message,"danger")}}else g("Please enter your full name (first and last).","danger")}),(async()=>{try{var e=await fetch(c+"/api/auth/me",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}});if(!e.ok)throw new Error("Failed to load profile data");var t,a,n,l,o=await e.json();document.getElementById("fullName").value=o.firstName+" "+o.lastName,o.dob&&(document.getElementById("dob").value=new Date(o.dob).toISOString().split("T")[0]),o.gender&&(document.getElementById("gender").value=o.gender),o.email&&(document.getElementById("email").value=o.email),o.phone&&(document.getElementById("phone").value=o.phone),o.activityStatus&&(document.getElementById("activityStatus").value=o.activityStatus),null!=o.startWeight&&(document.getElementById("startWeight").value=o.startWeight),null!=o.currentWeight&&(document.getElementById("currentWeight").value=o.currentWeight),o.goals&&(document.getElementById("goals").value=o.goals),o.reason&&(document.getElementById("reason").value=o.reason),o.createdAt&&(t=new Date(o.createdAt),a=new Date,n=Math.abs(a-t),l=Math.floor(n/864e5),document.getElementById("enrolledDays").value=l)}catch(e){g(e.message,"danger")}})()});