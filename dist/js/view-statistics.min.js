document.addEventListener("DOMContentLoaded",()=>{let a=["localhost","127.0.0.1"].includes(window.location.hostname)?"http://localhost:10000":"https://jefitness.onrender.com",n=null,i=null,s=null,l=null;(async()=>{r=r=await(async()=>{try{var t=await fetch(a+"/api/sleep?sortBy=date&order=asc",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}});if(t.ok)return await t.json();throw new Error("Failed to fetch sleep logs")}catch(t){return console.error(t),[]}})(),t=document.getElementById("sleepChart").getContext("2d"),e=r.map(t=>new Date(t.date).toISOString().split("T")[0]),r=r.map(t=>t.hoursSlept),n&&n.destroy(),n=new Chart(t,{type:"line",data:{labels:e,datasets:[{label:"Hours Slept",data:r,borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.2)",fill:!0,tension:.3,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,max:12,title:{display:!0,text:"Hours"}},x:{title:{display:!0,text:"Date"}}}}});var t=await(async()=>{try{var t=await fetch(a+"/api/auth/me",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}});if(t.ok)return await t.json();throw new Error("Failed to fetch user profile")}catch(t){return console.error(t),null}})(),e=(t&&(e=t.startWeight,r=t.currentWeight,t=document.getElementById("bmiChart").getContext("2d"),i&&i.destroy(),i=new Chart(t,{type:"bar",data:{labels:["Start Weight","Current Weight"],datasets:[{label:"Weight (lbs)",data:[e||0,r||0],backgroundColor:["rgba(255, 99, 132, 0.7)","rgba(75, 192, 192, 0.7)"],borderColor:["rgba(255, 99, 132, 1)","rgba(75, 192, 192, 1)"],borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Weight (lbs)"}}}}})),(t=await(async()=>{try{var t=await fetch(a+"/api/nutrition",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}});if(t.ok)return await t.json();throw new Error("Failed to fetch nutrition logs")}catch(t){return console.error(t),{nutritionLogs:[]}}})()).nutritionLogs||[]);{var r=e;t=document.getElementById("caloriesChart").getContext("2d");let a={};r.forEach(t=>{var e=new Date(t.date).toISOString().split("T")[0];a[e]=(a[e]||0)+t.calories});var o=(r=Object.keys(a).sort()).map(t=>a[t]);s&&s.destroy(),s=new Chart(t,{type:"line",data:{labels:r,datasets:[{label:"Daily Calories",data:o,borderColor:"rgba(255, 159, 64, 1)",backgroundColor:"rgba(255, 159, 64, 0.2)",fill:!0,tension:.3,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Calories"}},x:{title:{display:!0,text:"Date"}}}}})}t=e,r=document.getElementById("macroChart").getContext("2d"),t=t.reduce((t,e)=>(t.protein+=e.protein||0,t.carbs+=e.carbs||0,t.fats+=e.fats||0,t),{protein:0,carbs:0,fats:0}),l&&l.destroy(),l=new Chart(r,{type:"doughnut",data:{labels:["Protein","Carbs","Fats"],datasets:[{data:[t.protein,t.carbs,t.fats],backgroundColor:["rgba(54, 162, 235, 0.7)","rgba(255, 205, 86, 0.7)","rgba(255, 99, 132, 0.7)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 205, 86, 1)","rgba(255, 99, 132, 1)"],borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(t){return(t.label||"")+`: ${t.parsed||0}g`}}}}}})})()});