document.addEventListener("DOMContentLoaded",()=>{let r=["localhost","127.0.0.1"].includes(window.location.hostname)?"http://localhost:10000":"https://jefitness.onrender.com";var e=document.getElementById("sleepLogFormPage");let n=document.getElementById("sleepHoursInputPage"),t=document.getElementById("sleepHistoryList"),a=document.getElementById("formMessage"),s=[],o="date",l="desc";function i(e,t="success"){a.textContent=e,a.className="alert alert-"+t,a.classList.remove("d-none"),setTimeout(()=>{a.classList.add("d-none")},5e3)}async function c(){try{var e=await fetch(`${r}/api/sleep?sortBy=${o}&order=`+l,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}});if(!e.ok)throw new Error("Failed to fetch sleep logs");if(0===(s=await e.json()).length)t.innerHTML='<div class="text-muted text-center py-3">No sleep logs found.</div>';else{let a=`
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th scope="col" style="cursor:pointer" id="thDate">Date <i class="bi bi-arrow-down-up"></i></th>
            <th scope="col" style="cursor:pointer" id="thHours">Hours Slept <i class="bi bi-arrow-down-up"></i></th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
    `;s.forEach(e=>{var t=new Date(e.date).toISOString().split("T")[0];a+=`
        <tr data-id="${e._id}">
          <td class="date-cell">${t}</td>
          <td class="hours-cell">${e.hoursSlept}</td>
          <td>
          <button class="btn btn-sm btn-primary btn-edit">Edit</button>
          <!-- Delete button removed as per user request -->
          </td>
        </tr>
      `}),a+="</tbody></table>",t.innerHTML=a,document.getElementById("thDate").addEventListener("click",()=>{l="date"===o?"asc"===l?"desc":"asc":(o="date","asc"),c()}),document.getElementById("thHours").addEventListener("click",()=>{l="hoursSlept"===o?"asc"===l?"desc":"asc":(o="hoursSlept","asc"),c()}),document.querySelectorAll(".btn-edit").forEach(e=>{e.addEventListener("click",d)})}}catch(e){t.innerHTML='<div class="text-danger text-center py-3">Error loading sleep history.</div>',console.error(e)}}function d(e){let t=e.target.closest("tr"),a=t.dataset.id;var e=t.querySelector(".date-cell"),o=t.querySelector(".hours-cell"),n=new Date(e.textContent).toISOString().split("T")[0],e=(e.innerHTML=`<input type="date" class="form-control form-control-sm" value="${n}">`,o.innerHTML=`<input type="number" class="form-control form-control-sm" min="0" max="24" step="0.5" value="${o.textContent}">`,t.querySelector("td:last-child"));e.innerHTML=`
      <button class="btn btn-sm btn-success btn-save">Save</button>
      <button class="btn btn-sm btn-secondary btn-cancel">Cancel</button>
    `,e.querySelector(".btn-save").addEventListener("click",()=>(async(e,t)=>{var a=t.querySelector('input[type="date"]'),t=t.querySelector('input[type="number"]'),a=a.value,t=parseFloat(t.value);if(a)if(isNaN(t)||t<0||24<t)i("Please enter a valid number of hours between 0 and 24.","danger");else try{if(!(await fetch(r+"/api/sleep/"+e,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({date:a,hoursSlept:t})})).ok)throw new Error("Failed to update sleep log");i("Sleep log updated successfully."),await c()}catch(e){i("Error updating sleep log. Please try again.","danger"),console.error(e)}else i("Please select a valid date.","danger")})(a,t)),e.querySelector(".btn-cancel").addEventListener("click",()=>c())}e.addEventListener("submit",async a=>{a.preventDefault();a=parseFloat(n.value);if(isNaN(a)||a<0||24<a)i("Please enter a valid number of hours between 0 and 24.","danger");else{let t=(new Date).toISOString().split("T")[0];var o=s.find(e=>new Date(e.date).toISOString().split("T")[0]===t);try{let e;if(!(e=o?await fetch(r+"/api/sleep/"+o._id,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({date:t,hoursSlept:a})}):await fetch(r+"/api/sleep",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({date:t,hoursSlept:a})})).ok)throw new Error("Failed to log sleep");n.value="",i("Sleep logged successfully."),await c()}catch(e){i("Error logging sleep. Please try again.","danger"),console.error(e)}}}),c()});