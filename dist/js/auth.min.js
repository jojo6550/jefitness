document.addEventListener("DOMContentLoaded",()=>{let o=document.getElementById("login-form"),c=document.getElementById("signup-form"),n=document.getElementById("forgot-password-form"),s=document.getElementById("reset-password-form"),t=document.getElementById("message");let u=["localhost","127.0.0.1"].includes(window.location.hostname)?"http://localhost:10000":"https://jefitness.onrender.com";if(o&&o.addEventListener("submit",async e=>{e.preventDefault();var e=o.email.value,t=o.password.value;try{var a=await fetch(u+"/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),n=await a.json();a.ok?(localStorage.setItem("token",n.token),localStorage.setItem("userRole",n.user.role),"admin"===n.user.role?window.location.href="../pages/admin-dashboard.html":window.location.href="../pages/dashboard.html"):r(n.msg||"Login failed")}catch(e){r("Error connecting to server")}}),c){let s=document.getElementById("inputPassword"),r=document.getElementById("req-length"),i=document.getElementById("req-uppercase"),l=document.getElementById("req-lowercase"),d=document.getElementById("req-number"),m=document.getElementById("req-special");s.addEventListener("input",function(){var e=8<=(o=s.value).length,t=/[A-Z]/.test(o),a=/[a-z]/.test(o),n=/\d/.test(o),o=/[!@#$%^&*(),.?":{}|<>]/.test(o);r.className=e?"text-success":"text-muted",i.className=t?"text-success":"text-muted",l.className=a?"text-success":"text-muted",d.className=n?"text-success":"text-muted",m.className=o?"text-success":"text-muted"}),c.addEventListener("submit",async e=>{e.preventDefault();var e=document.getElementById("inputFirstName").value,t=document.getElementById("inputLastName").value,a=document.getElementById("inputEmail").value,n=document.getElementById("inputPassword").value;try{var o=await fetch(u+"/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e,lastName:t,email:a,password:n})}),s=await o.json();o.ok?(c.style.display="none",document.getElementById("otp-container").style.display="block",document.getElementById("otp-message").textContent="We sent a verification code to "+a):alert(s.msg||"Signup failed.")}catch(e){console.error("Error:",e),alert("Signup failed. Please try again.")}})}var e=document.getElementById("otp-form");if(e&&(e.addEventListener("submit",async e=>{e.preventDefault();var e=document.getElementById("inputEmail").value,t=document.getElementById("inputOtp").value;try{var a=await fetch(u+"/api/auth/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otp:t})}),n=await a.json();a.ok?(localStorage.setItem("token",n.token),localStorage.setItem("userRole",n.user.role),alert("Email verified! Welcome to JE Fitness."),window.location.href="../pages/dashboard.html"):alert(n.msg||"Verification failed.")}catch(e){console.error("Error:",e),alert("Verification failed. Please try again.")}}),document.getElementById("resendOtp").addEventListener("click",async()=>{var e=document.getElementById("inputFirstName").value,t=document.getElementById("inputLastName").value,a=document.getElementById("inputEmail").value,n=document.getElementById("inputPassword").value;try{(await fetch(u+"/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e,lastName:t,email:a,password:n})})).ok?alert("OTP resent to your email."):alert("Failed to resend OTP.")}catch(e){console.error("Error:",e),alert("Failed to resend OTP.")}})),n&&n.addEventListener("submit",async e=>{e.preventDefault();e=n.email.value;try{var t=await fetch(u+"/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),a=await t.json();t.ok?r(a.msg||"If an account with that email exists, a reset link has been sent."):r(a.msg||"Error sending reset email")}catch(e){r("Error connecting to server")}}),s){let n=new URLSearchParams(window.location.search).get("token");n?s.addEventListener("submit",async e=>{e.preventDefault();e=s.password.value;if(e!==s.confirmPassword.value)r("Passwords do not match");else try{var t=await fetch(u+"/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:n,password:e})}),a=await t.json();t.ok?(r(a.msg||"Password reset successfully"),setTimeout(()=>{window.location.href="login.html"},2e3)):r(a.msg||"Error resetting password")}catch(e){r("Error connecting to server")}}):r("Invalid reset link. Please request a new password reset.")}function r(e){t?(t.textContent=e,t.style.display="block"):alert(e)}});