class AdminLogsManager{constructor(){this.currentPage=1,this.limit=50,this.currentFilters={},this.sortBy="timestamp",this.sortOrder="desc",this.initializeEventListeners(),this.loadLogs(),this.loadLogStats()}initializeEventListeners(){document.getElementById("refreshLogs")?.addEventListener("click",()=>{this.loadLogs(),this.loadLogStats()}),document.getElementById("exportLogs")?.addEventListener("click",()=>{this.exportLogs()}),document.getElementById("logLevelFilter")?.addEventListener("change",t=>{this.currentFilters.level=t.target.value,this.currentPage=1,this.loadLogs()}),document.getElementById("logCategoryFilter")?.addEventListener("change",t=>{this.currentFilters.category=t.target.value,this.currentPage=1,this.loadLogs()}),document.getElementById("logStartDate")?.addEventListener("change",t=>{this.currentFilters.startDate=t.target.value,this.currentPage=1,this.loadLogs()}),document.getElementById("logEndDate")?.addEventListener("change",t=>{this.currentFilters.endDate=t.target.value,this.currentPage=1,this.loadLogs()});let e;document.getElementById("logSearch")?.addEventListener("input",t=>{clearTimeout(e),e=setTimeout(()=>{this.currentFilters.search=t.target.value,this.currentPage=1,this.loadLogs()},500)}),document.querySelectorAll("[data-sort]").forEach(e=>{e.addEventListener("click",()=>{var t=e.getAttribute("data-sort");this.sortBy===t?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortBy=t,this.sortOrder="desc"),this.loadLogs(),this.updateSortIcons()})})}updateSortIcons(){document.querySelectorAll("[data-sort] i").forEach(t=>{t.className="bi bi-sort-down ml-1"});var t=document.querySelector(`[data-sort="${this.sortBy}"]`);t&&(t.querySelector("i").className="asc"===this.sortOrder?"bi bi-sort-up ml-1":"bi bi-sort-down ml-1")}async loadLogs(){try{var t=new URLSearchParams({page:this.currentPage,limit:this.limit,sortBy:this.sortBy,sortOrder:this.sortOrder,...this.currentFilters}),e=await fetch(API_BASE_URL+"/api/logs?"+t,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}});if(!e.ok)throw new Error("Failed to fetch logs");var r=await e.json();this.renderLogs(r.logs),this.renderPagination(r.pagination)}catch(t){console.error("Error loading logs:",t),this.showError("Failed to load logs. Please try again.")}}async loadLogStats(){try{var t=new URLSearchParams(this.currentFilters),e=await fetch(API_BASE_URL+"/api/logs/stats?"+t,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}});if(!e.ok)throw new Error("Failed to fetch log statistics");var r=await e.json();this.renderLogStats(r)}catch(t){console.error("Error loading log statistics:",t)}}renderLogs(t){var e=document.getElementById("logsTableBody");e&&(0===t.length?e.innerHTML=`
                <tr>
                    <td colspan="5" class="px-6 py-8 text-center text-sm text-gray-500">
                        No logs found matching your criteria.
                    </td>
                </tr>
            `:e.innerHTML=t.map(t=>`
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    ${new Date(t.timestamp).toLocaleString()}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${this.getLevelBadgeClass(t.level)}">
                        ${t.level.toUpperCase()}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${this.getCategoryBadgeClass(t.category)}">
                        ${t.category.toUpperCase()}
                    </span>
                </td>
                <td class="px-6 py-4 text-sm text-gray-900 max-w-xs truncate" title="${t.message}">
                    ${t.message}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    ${t.userId?t.userId.firstName+" "+t.userId.lastName:"-"}
                </td>
            </tr>
        `).join(""))}renderPagination(e){var r=document.getElementById("logsPaginationInfo"),t=document.getElementById("logsPagination");if(r&&t)if(r.textContent=`Showing ${0<e.currentPage*e.totalPages?(e.currentPage-1)*this.limit+1:0} to ${Math.min(e.currentPage*this.limit,e.totalLogs)} of ${e.totalLogs} entries`,e.totalPages<=1)t.innerHTML="";else{var a=[],r=(e.hasPrev&&a.push(`
                <li>
                    <button class="px-3 py-1 text-sm text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50" onclick="adminLogs.previousPage()">
                        Previous
                    </button>
                </li>
            `),Math.max(1,e.currentPage-2)),o=Math.min(e.totalPages,e.currentPage+2);1<r&&(a.push(`
                <li>
                    <button class="px-3 py-1 text-sm text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" onclick="adminLogs.goToPage(1)">1</button>
                </li>
            `),2<r)&&a.push(`
                    <li>
                        <span class="px-3 py-1 text-sm text-gray-500">...</span>
                    </li>
                `);for(let t=r;t<=o;t++)a.push(`
                <li>
                    <button class="px-3 py-1 text-sm ${t===e.currentPage?"text-white bg-blue-600 border-blue-600":"text-gray-700 bg-white border-gray-300"} border rounded-md hover:bg-gray-50" onclick="adminLogs.goToPage(${t})">
                        ${t}
                    </button>
                </li>
            `);o<e.totalPages&&(o<e.totalPages-1&&a.push(`
                    <li>
                        <span class="px-3 py-1 text-sm text-gray-500">...</span>
                    </li>
                `),a.push(`
                <li>
                    <button class="px-3 py-1 text-sm text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" onclick="adminLogs.goToPage(${e.totalPages})">
                        ${e.totalPages}
                    </button>
                </li>
            `)),e.hasNext&&a.push(`
                <li>
                    <button class="px-3 py-1 text-sm text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50" onclick="adminLogs.nextPage()">
                        Next
                    </button>
                </li>
            `),t.innerHTML=a.join("")}}renderLogStats(t){if(document.getElementById("logStats")){let e={error:0,warn:0,info:0,debug:0};t.forEach(t=>{e.hasOwnProperty(t._id)&&(e[t._id]=t.count)}),document.getElementById("errorCount").textContent=e.error,document.getElementById("warnCount").textContent=e.warn,document.getElementById("infoCount").textContent=e.info,document.getElementById("debugCount").textContent=e.debug,document.getElementById("totalLogsCount").textContent=Object.values(e).reduce((t,e)=>t+e,0)}}getLevelBadgeClass(t){return{error:"bg-red-100 text-red-800",warn:"bg-yellow-100 text-yellow-800",info:"bg-blue-100 text-blue-800",debug:"bg-gray-100 text-gray-800"}[t]||"bg-gray-100 text-gray-800"}getCategoryBadgeClass(t){return{general:"bg-gray-100 text-gray-800",admin:"bg-purple-100 text-purple-800",user:"bg-green-100 text-green-800",security:"bg-red-100 text-red-800",auth:"bg-blue-100 text-blue-800"}[t]||"bg-gray-100 text-gray-800"}async exportLogs(){try{var t=new URLSearchParams({...this.currentFilters}),e=await fetch(API_BASE_URL+"/api/logs/export?"+t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(!e.ok)throw new Error("Failed to export logs");var r=await e.blob(),a=window.URL.createObjectURL(r),o=document.createElement("a");o.style.display="none",o.href=a,o.download=`logs_${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(a),document.body.removeChild(o)}catch(t){console.error("Error exporting logs:",t),this.showError("Failed to export logs. Please try again.")}}showError(t){let e=document.createElement("div");e.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.remove()},5e3)}nextPage(){this.currentPage++,this.loadLogs()}previousPage(){this.currentPage--,this.loadLogs()}goToPage(t){this.currentPage=t,this.loadLogs()}}document.addEventListener("DOMContentLoaded",()=>{window.adminLogs=new AdminLogsManager});